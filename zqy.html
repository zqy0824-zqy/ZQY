<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>æ¶ˆæ¶ˆä¹æ¸¸æˆ</title>
    <style>
        /* æ¸¸æˆç½‘æ ¼æ ·å¼ */
      .game-grid {
            display: grid;
            grid-template-columns: repeat(8, 50px);
            grid-template-rows: repeat(8, 50px);
            gap: 5px;
        }

        /* æ¯ä¸ªæ ¼å­çš„æ ·å¼ */
      .cell {
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <h1>æ¶ˆæ¶ˆä¹æ¸¸æˆ</h1>
    <div class="game-grid" id="gameGrid"></div>
    <p id="score">å¾—åˆ†: 0</p>

    <script>
        // æ¸¸æˆç½‘æ ¼å¤§å°
        const gridSize = 8;
        // å­˜å‚¨æ¸¸æˆç½‘æ ¼æ•°æ®çš„äºŒç»´æ•°ç»„
        let gameGridData = [];
        // ç”¨äºå­˜å‚¨å¯æ¶ˆé™¤çš„æ ¼å­
        let toBeRemoved = [];
        // å¾—åˆ†
        let score = 0;

        // ç”Ÿæˆéšæœºå›¾æ¡ˆ
        function generateRandomPattern() {
            const patterns = ['ğŸ', 'ğŸŒ', 'ğŸ‡', 'ğŸ“', 'ğŸ¥', 'ğŸ’', 'ğŸ', 'ğŸ¥­'];
            return patterns[Math.floor(Math.random() * patterns.length)];
        }

        // åˆå§‹åŒ–æ¸¸æˆç½‘æ ¼
        function initGameGrid() {
            const gameGrid = document.getElementById('gameGrid');
            for (let i = 0; i < gridSize; i++) {
                gameGridData[i] = [];
                for (let j = 0; j < gridSize; j++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    const pattern = generateRandomPattern();
                    cell.textContent = pattern;
                    gameGrid.appendChild(cell);
                    gameGridData[i][j] = pattern;
                    cell.addEventListener('click', function () {
                        checkMatches(cell, i, j);
                    });
                }
            }
        }

        // æ£€æŸ¥ç‚¹å‡»æ ¼å­å‘¨å›´åŠè‡ªèº«çš„åŒ¹é…æƒ…å†µ
        function checkMatches(cell, row, col) {
            const pattern = gameGridData[row][col];
            toBeRemoved = [];

            // æ£€æŸ¥æ¨ªå‘åŒ¹é…
            for (let j = col; j >= 0 && gameGridData[row][j] === pattern; j--) {
                toBeRemoved.push({ row: row, col: j });
            }
            for (let j = col + 1; j < gridSize && gameGridData[row][j] === pattern; j++) {
                toBeRemoved.push({ row: row, col: j });
            }

            // æ£€æŸ¥çºµå‘åŒ¹é…
            for (let i = row; i >= 0 && gameGridData[i][col] === pattern; i--) {
                toBeRemoved.push({ row: i, col: col });
            }
            for (let i = row + 1; i < gridSize && gameGridData[i][col] === pattern; i++) {
                toBeRemoved.push({ row: i, col: col });
            }

            // å¦‚æœæœ‰ä¸‰ä¸ªæˆ–æ›´å¤šç›¸åŒå›¾æ¡ˆå¯æ¶ˆé™¤
            if (toBeRemoved.length >= 3) {
                removeMatches();
            }
        }

        // æ¶ˆé™¤åŒ¹é…çš„æ ¼å­
        function removeMatches() {
            toBeRemoved.forEach(function (cellData) {
                const cell = document.querySelectorAll('.cell')[cellData.row * gridSize + cellData.col];
                cell.textContent = '';
                gameGridData[cellData.row][cellData.col] = null;
            });
            score += toBeRemoved.length;
            updateScore();
            dropCells();
            fillTop();
        }

        // æ›´æ–°å¾—åˆ†æ˜¾ç¤º
        function updateScore() {
            const scoreElement = document.getElementById('score');
            scoreElement.textContent = 'å¾—åˆ†: ' + score;
        }

        // è®©ä¸Šæ–¹çš„æ ¼å­ä¸‹è½å¡«å……ç©ºç™½
        function dropCells() {
            for (let col = 0; col < gridSize; col++) {
                let emptyRow = -1;
                for (let row = 0; row < gridSize; row++) {
                    if (gameGridData[row][col] === null) {
                        if (emptyRow === -1) {
                            emptyRow = row;
                        }
                    } else if (emptyRow!== -1) {
                        gameGridData[emptyRow][col] = gameGridData[row][col];
                        gameGridData[row][col] = null;
                        const cellToMove = document.querySelectorAll('.cell')[row * gridSize + col];
                        const cellToDrop = document.querySelectorAll('.cell')[emptyRow * gridSize + col];
                        cellToMove.textContent = '';
                        cellToDrop.textContent = gameGridData[emptyRow][col];
                        emptyRow++;
                    }
                }
            }
        }

        // åœ¨é¡¶éƒ¨ç”Ÿæˆæ–°çš„å›¾æ¡ˆå¡«å……ç©ºç™½
        function fillTop() {
            for (let col = 0; col < gridSize; col++) {
                for (let row = gridSize - 1; row >= 0 && gameGridData[row][col] === null; row--) {
                    const cell = document.querySelectorAll('.cell')[row * gridSize + col];
                    const pattern = generateRandomPattern();
                    cell.textContent = pattern;
                    gameGridData[row][col] = pattern;
                }
            }
            checkNoMatches();
        }

        // æ£€æŸ¥æ˜¯å¦æ²¡æœ‰å¯æ¶ˆé™¤çš„å›¾æ¡ˆï¼Œè‹¥æ²¡æœ‰åˆ™æ¸¸æˆç»“æŸæˆ–æ ¹æ®éœ€æ±‚å¤„ç†
        function checkNoMatches() {
            let noMatches = true;
            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    const cell = document.querySelectorAll('.cell')[i * gridSize + j];
                    const pattern = gameGridData[i][j];
                    toBeRemoved = [];

                    // å†æ¬¡æ£€æŸ¥ç‚¹å‡»æ ¼å­å‘¨å›´åŠè‡ªèº«çš„åŒ¹é…æƒ…å†µï¼ˆç±»ä¼¼checkMatchesé€»è¾‘ï¼‰
                    // æ£€æŸ¥æ¨ªå‘åŒ¹é…
                    for (let j2 = j; j2 >= 0 && gameGridData[i][j2] === pattern; j2--) {
                        toBeRemoved.push({ row: i, col: j2 });
                    }
                    for (let j2 = j + 1; j2 < gridSize && gameGridData[i][j2] === pattern; j2++) {
                        toBeRemoved.push({ row: i, col: j2 });
                    }

                    // æ£€æŸ¥çºµå‘åŒ¹é…
                    for (let i2 = i; i2 >= 0 && gameGridData[i2][j] === pattern; i2--) {
                        toBeRemoved.push({ row: i2, col: j });
                    }
                    for (let i2 = i + 1; i2 < gridSize && gameGridData[i2][j] === pattern; i2++) {
                        toBeRemoved.push({ row: i2, col: j });
                    }

                    if (toBeRemoved.length >= 3) {
                        noMatches = false;
                        break;
                    }
                }
                if (!noMatches) {
                    break;
                }
            }
            if (noMatches) {
                alert('æ¸¸æˆç»“æŸï¼Œæ‚¨çš„å¾—åˆ†æ˜¯ï¼š' + score);
            }
        }

        initGameGrid();
    </script>
</body>

</html>